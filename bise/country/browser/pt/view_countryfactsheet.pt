<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone.z3cform"
      metal:use-macro="context/@@standard_macros/page">

  <body metal:fill-slot="body">
    <div tal:define="
        tabs python: [r.to_object for r in context.relatedItems];
        labels python: context.tab_titles or ['Factsheet', 'Contributions', 'MAES'];
        tabs python: zip(labels, tabs);
        countries python: context.aq_parent.getFolderContents(
              contentFilter={'portal_type': 'countryfactsheet',
                             'sort_on': 'sortable_title',
                             'sort_order': 'ascending'}
              )">

      <div class="country-header"  tal:attributes="data-zoom-country context/getId" >
        <svg-container class="svg-wrapper">
          <svg></svg>
        </svg-container>
      </div>

    <script tal:define="countries_json python: str([x.Title() for x in context.aq_parent.listFolderContents()])"
           tal:content="string: var available_map_countries = ${countries_json};"></script>

      <!-- TODO: test if links can work with https by replacing http with // -->
      <!-- This is for fixing the various maps that are included in the Biodiversity -->
      <!-- Factsheet tab -->
      <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/dojo/dijit/themes/claro/claro.css" />
      <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5/js/esri/css/esri.css" />
      <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
      <script src="http://d3js.org/d3.geo.projection.v0.min.js" charset="utf-8"></script>
      <script src="http://d3js.org/topojson.v1.min.js"></script>
      <script src="http://d3js.org/queue.v1.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <script src="/++resource++bise.biodiversityfactsheet/mapsConfig.js" ></script>
      <script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.5" ></script>
      <script src="/++resource++bise.biodiversityfactsheet/layout.js" ></script>
      <script src="/++resource++bise.biodiversityfactsheet/maps.js" ></script>

      <!-- This is used by the svg header map -->
      <script src="/++resource++bise.country/js/factsheets-map.js"></script>

      <!-- this is IE Compatibility for the Contributions tab, left side nav menu -->
      <script type="text/javascript" src="++resource++bise.country/js/i-sticky.js" ></script>

      <!-- This is for the top navigation tabs in a country factsheet page -->
      <script src="++resource++bise.country/js/countryfactsheets.js" ></script>
      <link rel="stylesheet" href="++resource++bise.country/css/countryfactsheet-page.css" />
      <link rel="stylesheet" href="++resource++bise.country/css/countryfactsheet-map.css" />

      <span class="custom-dropdown" tal:condition="python: len(countries) > 1">
        <select>
          <option selected="selected" tal:attributes="value context/aq_parent/absolute_url">---</option>
          <option tal:repeat="country countries"
            tal:content="country/Title"
            tal:attributes="value country/getURL; selected python: country.id == context.id">
          12345678910112
          </option>
        </select>
      </span>

      <div class="panel with-nav-tabs panel-default">
        <div class="panel-heading">
          <ul class="nav nav-tabs" role="tablist" id="country-tabs" tal:condition="tabs">
            <li role="presentation" tal:repeat="lc tabs">
              <a href=""
                 data-toggle="tab"
                 tal:attributes="href string:#t-${repeat/lc/index}"
                 tal:content="python: lc[0]">
                Title
              </a>
            </li>
          </ul>
        </div>

        <div class="panel-body">
          <div class="tab-content" tal:condition="tabs">
            <div
               tal:repeat="lc tabs"
               tal:attributes="id string:#t-${repeat/lc/index}"
               >
               <div tal:condition="python: view.can_edit(lc[1])" tal:define="obj python: lc[1]">
                 <a href="" target="_blank" tal:attributes="href string:${obj/absolute_url}/edit">Edit this page</a>
               </div>
               <div tal:content="structure python: view.view_page(lc[1])">
                 page inside here
               </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <script type="text/javascript">
$(document).ready(function() {
  $('.collapsible').collapsiblePanel({defaultOpen: 'content-header'});
  $("body").addClass("claro");
  $("#targetFilter input:checkbox").change(function() {
    var filter = "?";
    if ($("#targetFilter input:checked").length > 0){
      var targets = "";
      for(i=0; i <  $("#targetFilter input:checked").length; i++){
        targets += $("input:checked")[i].value + ","
      }
      targets = targets.substring(0, targets.length - 1)
      filter += "targets=" + targets;
    }
    if (window.location.pathname.endsWith("/view")){
      window.location.href = window.location.pathname + filter;
    }else if (window.location.pathname.endsWith("/")){
      window.location.href = window.location.pathname + "view" + filter;
    }else{
      window.location.href = window.location.pathname + "/view" + filter;
    }
  })
});
    </script>

  </body>
</html>
